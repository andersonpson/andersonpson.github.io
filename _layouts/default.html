<!DOCTYPE html>
<html>
  <head>
    <title>{% if page.title %}{{ page.title }} – {% endif %}{{ site.name }} – {{ site.description | strip_newlines }}</title>

    {% include meta.html %}

    <link rel="stylesheet" type="text/css" href="{{ site.baseurl }}/assets/css/main.css" />
    <link rel="alternate" type="application/rss+xml" title="{{ site.name }} - {{ site.description | strip_newlines }}" href="{{ site.baseurl }}/feed.xml" />
  </head>

  <body class="{% if page.url == '/' %}home-page{% endif %}">
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead">
          
          <div class="site-info">
            <h1 class="site-name">
              <a href="{{ site.baseurl }}/">{{ site.name }}</a>
            </h1>
            <p class="site-description">{{ site.description | newline_to_br }}</p>
          </div>

          <nav>
            {% for link in site.navigation %}
              <a href="{{ site.baseurl }}{{ link.url }}">{{ link.name }}</a>
            {% endfor %}

            <a href="javascript:void(0);" id="theme-toggle" title="切换模式" class="theme-toggle-link">
              <img id="theme-icon-img" src="{{ site.baseurl }}/assets/images/moon.png" alt="切换模式">
            </a>
          </nav>

        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      {{ content }}
    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          {% include svg-icons.html %}
          
          <div class="copyright">
            &copy; {{ site.time | date: "%Y" }} {{ site.name }}. All rights reserved.
          </div>
        </footer>
      </div>
    </div>

    {% include analytics.html %}
    
    <script>
      const toggleBtn = document.getElementById('theme-toggle');
      const themeIconImg = document.getElementById('theme-icon-img');
      const htmlElement = document.documentElement;

      const savedTheme = localStorage.getItem('theme') || 'light';
      htmlElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);

      toggleBtn.addEventListener('click', () => {
        const currentTheme = htmlElement.getAttribute('data-theme');
        const targetTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        htmlElement.setAttribute('data-theme', targetTheme);
        localStorage.setItem('theme', targetTheme);
        updateThemeIcon(targetTheme);
      });

      function updateThemeIcon(theme) {
        if (themeIconImg) {
          const basePath = "{{ site.baseurl }}/assets/images/";
          if (theme === 'dark') {
            themeIconImg.src = basePath + "sun.png";
          } else {
            themeIconImg.src = basePath + "moon.png";
          }
        }
        
        const bannerImg = document.querySelector('.home-banner img, .full-width-banner img');
        if (bannerImg) {
          const src = bannerImg.src;
          if (theme === 'dark') {
            if (!src.includes('_dark')) {
              bannerImg.src = src.replace(/(\.jpg|\.png|\.jpeg)/, '_dark$1');
            }
          } else {
            bannerImg.src = src.replace('_dark', '');
          }
        }
      }
    </script>
  </body>
</html>
